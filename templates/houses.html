{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>luner rent</title>
    <link
      rel="stylesheet"
      href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css"
    />
    <link href="../static/styles.css" rel="stylesheet" />
  </head>
  <body>
    <input type="checkbox" id="nav-toggle" />
    <div class="sidebar">
      <div class="sidebar-brand">
        <h2>
          <img style="border-radius:10px"src="{% static "logo.jpg" %}">
        </h2>
      </div>
      <div class="sidebar-menu">
        <ul>
          <li>
            <a href="{% url "ownershome"%}"
              ><span class="las la-igloo"></span><span>Dashboard</span></a
            >
          </li>
          <li>
            <a href="{% url "ownersprofile"%}"
              ><span class="las la-users"></span><span></span>Profile</a
            >
          </li>
          <li>
            <a href="{% url "tenants"%}"
              ><span class="las la-id-card"></span><span>Tenants</span></a
            >
          </li>
          <li>
            <a href="{% url "rooms" %}"
              ><span class="las la-car"></span><span>Rooms</span></a
            >
          </li>
          <li>
            <a href="{% url "addhouses"%}"
              ><span class="las la-receipt"></span
              ><span>Add new Houses</span></a
            >
          </li>
          <li>
            <a href="#"
              ><span class="las la-clipboard-check"></span
              ><span>Bulk SMS</span></a>
          </li>
          <li>
            <a href="#"
              ><span class="las la-clipboard-check"></span
              ><span>Bulk Whatsapp</span></a>
          </li>
          
        </ul>
        <ul class="bottom-menu">
          <li>
              <a href="#"
                  ><span class="las la-sign-out-alt"></span><span>Logout</span></a
              >
          </li>
      </ul>
      </div>
    </div>
    <div class="main-content">
      <header>
        <h2>
          <label for="nav-toggle">
            <span class="las la-bars"></span>
          </label>
          <span class="las la-user"></span>
          {{ request.user.username }}
        </h2>
        <!--<div class="search-wrapper">
          <span class="las la-search"></span>
          <input type="" placeholder="Search here..." />
        </div>-->
        <img style="position:relative;max-height:2%"src="{% static "logo.jpg" %}">
      </header>
      <main>
        <form action="{% url "addhouses" %}" method="POST" enctype="multipart/form-data">
        <div class="container position-relative">
          <div class="row">
              <div class="col-md-6">
                <div class="input-field">
                  <label>HOUSE NAME</label><br>
                  <input type="text" name="name" placeholder="Enter last the gouse name">
                </div>
              </div>
              <div class="col-md-6">
                <div class="input-field">
                  <label>COVER IMAGE</label><br>
                  <input type="file" name="coverimage" accept="image/*" placeholder="Enter last service distance">
                </div>
              </div>
              <div class="input-field">
                <label for="county">COUNTY</label><br>
                <select id="county" name="county" required>
                    <option value="" disabled selected>Select county</option>
                    {% for location in locations %}
                    <option value="{{location.county}}" >{{location.county}}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="input-field">
              <label for="subcounty">SUB-COUNTY</label><br>
              <select id="subcounty" name="county" required>
                  <option value="" disabled selected>Select sub-county</option>
              </select>
          </div>
          <div class="input-field">
            <label for="ward">WARD</label><br>
            <select id="ward" name="ward" required>
                <option value="" disabled selected>Select ward</option>
            </select>
        </div>
              <!-- Add more input fields as needed -->
          </div>
      </div>
      
      </main>
      <footer style="bottom-margin:0;">
        <p style="text-align: center;">Copyright &#169; 2024 Lunertechs. All Rights Reserved.</p>
      </footer>
      <script>
        // Get references to the select elements
        var countySelect = document.getElementById("county");
        var subcountySelect = document.getElementById("subcounty");
        var wardSelect=document.getElementById("ward")

        // Add event listener for focus event on subcounty select element
        subcountySelect.addEventListener('focus', function (event) {
            // Check if a county is selected
            if (!countySelect.value) {
                // Show alert if no county is selected
                alert("Please select a county first.");
                // Prevent the dropdown from opening
                event.preventDefault();
                subcountySelect.blur();
            }
            else{
              subcountySelect.value=""
              while (subcountySelect.firstChild) {
                subcountySelect.removeChild(subcountySelect.firstChild);
            }
              var county = countySelect.value;
              fetch("{% url 'subcounties' %}?county=" + encodeURIComponent(county))
                  .then(response => {
                      if (!response.ok) {
                          throw new Error('Network response was not ok');
                      }
                      return response.json(); // Parse JSON response
                  })
                  .then(data => {
                      console.log('Data received:', data);
                      // Process the parsed data as 
                      data.data.forEach(subcounty => {
                        const option = document.createElement('option');
                        option.value = subcounty;
                        option.textContent = subcounty;
                        subcountySelect.appendChild(option);
                    });
                  })
                  .catch(error => {
                      console.error('There was a problem with your fetch operation:', error);
                  });

            }
        });
        wardSelect.addEventListener('focus', function (event) {
          // Check if a county is selected
          if (!countySelect.value || !wardSelect.value) {
              // Show alert if no county is selected
              alert("Please select a county and subcounty first.");
              // Prevent the dropdown from opening
              event.preventDefault();
              subcountySelect.blur();
          }
          else{
            wardSelect.value=""
            while (wardSelect.firstChild) {
              wardSelect.removeChild(wardSelect.firstChild);
          }
            var county = countySelect.value;
            var subcounty= subcountySelect.value
            fetch("{% url 'wards' %}?county=" + encodeURIComponent(county)+"&subcounty="county= + encodeURIComponent(subcounty))
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json(); // Parse JSON response
                })
                .then(data => {
                    console.log('Data received:', data);
                    // Process the parsed data as 
                    data.data.forEach(subcounty => {
                      const option = document.createElement('option');
                      option.value = subcounty;
                      option.textContent = subcounty;
                      subcountySelect.appendChild(option);
                  });
                })
                .catch(error => {
                    console.error('There was a problem with your fetch operation:', error);
                });

          }
      });
      </script>
      {% if messages %}
    <div class="messages">
      {% for message in messages %}
      <script>
        alert("{{ message }}");
      </script>
      {% endfor %}
    </div>
    {% endif %}
  </body>
</html>
